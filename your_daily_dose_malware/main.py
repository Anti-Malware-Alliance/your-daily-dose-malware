import argparse

from dotenv import load_dotenv
from rich.console import Console

from your_daily_dose_malware.backends import malware_bazaar
from your_daily_dose_malware.constants import (
                                    MALWARE_BANNER,
                                    MALWARE_DESCRIPTION)

load_dotenv()


def run_scrapper(args):
    malware_bazaar.scrap_malware_bazaar(args.hundred_recent)


def main():
    parser = argparse.ArgumentParser(
        description="""Download recent samples from multiple OSINT provider
         backends
        "MalwareBazaar: all the recent recent malware's uploaded within"
        "the last 48 hours sha256 hash"
        "MalwareBazaar: By using api from 'https://mb-api.abuse.ch/api/v1/'"""
    )
    parser.add_argument(
        "-MwBz_48H",
        "--last-48H",
        action="store_true",
        help="get the most recent sha256 hashes",
        default=True,
    )
    parser.add_argument(
        "-MwBz_100",
        "--hundred-recent",
        action="store_true",
        help="""get the most recent hundred recent malware's
         uploaded within the last 60 min""",
    )
    args = parser.parse_args()

    console = Console()
    console.print(MALWARE_BANNER)
    console.print(f"{MALWARE_DESCRIPTION} \n")

    run_scrapper(args)


if __name__ == "__main__":
    main()
