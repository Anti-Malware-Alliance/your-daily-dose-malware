import click
from .commands.scraper import scraper
from .commands.utils.retrieve_malware import all_most_recent, hundred_most_recent
from dotenv import load_dotenv
import os
load_dotenv()

@click.command(
    help="""
    Download eitheir hundred recent malwares uploaded within the last 60 min or  all the recent malwares uploaded within the last 48 hours sha256 hash by using api from 'https://mb-api.abuse.ch/api/v1/' 

    -s256 or --by-sha256: get the lastest sha256 hashes from 'https://bazaar.abuse.ch/export/txt/sha256/recent' save them in sha256_names.txt then for each file  download all malwares in zip file

    -hr or --hundred-recent: get the lastest hundred recent malwares uploaded within the last 60 min
    """)
@click.option('-s256','--by-sha256',is_flag=True)
@click.option('-hr','--hundred-recent',is_flag=True)
def run_scrapper(by_sha256, hundred_recent):
    headers = {
        'API-KEY':os.getenv('API_KEY')
    }
    if hundred_recent:
        hundred_most_recent(headers)
    elif by_sha256:
        all_most_recent(headers)
    else:
        click.echo('	No selector provided. Please use either by_sha256, hundred_recent as selector',)

if __name__ == '__main__':
    scraper.add_command(run_scrapper)
    scraper()
